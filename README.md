# Домашнее задание "Основы backend-разработки"

### Сборка и запуск проекта

1. склонировать репозиторий `git clone https://github.com/VasenkovArtem/ds-backend .`
2. выполнить команду `docker build -t ds-backend .`
3. запустить сервис командой `./run.sh`
4. открыть в браузере страницу `http://<vm_ip>:8080` и проверить, что выводится строка "Hello user!"

### Описание работы проекта

- Все функции обработки, проверки id изображения на валидность, получения изображения с внешнего сервера и  описаны в модуле utils.py:
  - `check_img_id_valid` &mdash; проверяет, является ли строка, переданная в качестве параметра, допустимой в качестве значения идентификатора. Считается, что id — натуральное число, поэтому строка должна состоять только из цифр и не начинаться с нуля
  - `get_image_from_id` &mdash; обращается к внешнему серверу и запрашивает картинку с указанным id, выдаёт различные коды http-ответов в зависимости от ответа внешнего сервера
  - `read_plate_number` &mdash; принимает на вход изображение с номером автомобиля и распознает этот номер при помощи модели `plate_reader`
  - `process_image_id_to_plate_number` &mdash; объединяет в себе перечисленные выше функции в один цикл обработки изображения и выдачи номера автомобиля по переданному id:
    - принимает идентификатор изображения в качестве входных данных
    - проверяет полученный идентификатор на валидность
    - делает запрос на внешний сервер и получает изображение в качестве ответа
    - отправляет полученное изображение в модель и с её помощью распознает номер автомобиля
  - `result_json_handler` &mdash; приводит результат, переданный ей в качестве параметра, в формат json (словарь), или возвращает ошибку (словарь с полем error &mdash; сообщение об ошибке и http номер ответа)
- В файле `app.py` описана работа сервера и обработчиков, в частности:
  - `read_plate_number_from_image`, `<vm_ip>:8080/readPlateNumberFromImage` &mdash; считывает номер автомобиля из картинки, переданной в байтовом формате при помощи метода POST
  - `read_plate_number_from_id`, `<vm_ip>:8080/readPlateNumberFromID?id=10022`: &mdash; считывает номер автомобиля из изображения, запрошенного с внешнего сервера, по его ID-номеру, полученному от пользователя методом GET
  - `read_plate_number_from_ids`, `<vm_ip>:8080/readPlateNumberFromIDs?id=10022&id=9965`: &mdash; считывает номер автомобиля с нескольких запрошенных с внешнего сервера изображений по их ID номерам, полученным от пользователя методом GET
- Также создан отдельный класс, содержащий в себе описание ошибок, которые могут возникнуть в процессе работы сервера &mdash; для того, чтобы проще создавать ту или иную ошибку (поскольку их предполагается небольшое число), унифицировать вывод в требуемом формате, а также возвращать различные сообщения для одного и того же типа ошибки. Список ошибок:
  - `0: ('field not found', 400)` &mdash; требуемый аргумент не передан пользователем
  - `1: ('invalid image', 400)` &mdash; невалидное изображение
  - `2: ('image not found', 404)` &mdash; изображение не найдено на внешнем сервере
  - `3: ('service with images unavailable', 424)` &mdash; внешний сервер с изображениями недоступен
  - `4: ('invalid access to the service with images', 500)` &mdash; ошибка обращения к внешнему серверу с изображениями с данного сервера
  - `5: ('invalid image id', 400)` &mdash; невалидный id изображения
  - `6: ('image not in byte format', 415)` &mdash; переданное изображение формат, отличный от требуемого (не байтовый)
  - `7: ('invalid number of parameters of returned json', 500)` &mdash; несовпадение числа ключей и значений при отображении результатов работы сервера в формате json
  - `8: ('unknown error', 500)` &mdash; другая неизвестная ошибка
- Примеры работы &mdash; при переходе по ссылкам:
  - `http://<vm_ip>:8080/readPlateNumberFromID?id=10022`
  - `http://<vm_ip>:8080/readPlateNumberFromID?id=18`
  - `http://<vm_ip>:8080/readPlateNumberFromID?id=plate163`
  - `http://<vm_ip>:8080/readPlateNumberFromIDs?id=10022&id=9965`
  - `http://<vm_ip>:8080/readPlateNumberFromIDs?id=18&id=10022&id=9965`
